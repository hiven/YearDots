{% extends "base.html" %}

{% block title %}Habit Tracker - Calendar{% endblock %}

{% block content %}
<div class="habit-select">
  {% if habits %}
    <form method="GET" action="/">
      <select name="habit_id" onchange="this.form.submit()">
        {% for habit in habits %}
          <option value="{{ habit.id }}" {% if selected_habit and habit.id == selected_habit.id %}selected{% endif %}>
            {{ habit.name }}
          </option>
        {% endfor %}
      </select>
      <a href="{{ url_for('main.add_habit') }}">+ Add Habit</a>
      <a href="{{ url_for('main.add_activity') }}">+ Add Activity</a>
    </form>
  {% else %}
    <p>No habits yet. <a href="{{ url_for('main.add_habit') }}">Add a Habit</a> to start tracking!</p>
  {% endif %}
</div>

<h1>
  {% if selected_habit %}
    Tracking: {{ selected_habit.name }}
  {% else %}
    Year Calendar
  {% endif %}
</h1>

<div class="year-grid">
  {% for month in months %}
    <div class="month">
      <div>{{ month.name }}</div>
      <div class="dots">
        {% for _ in range(month.start_empty) %}
          <div class="dot empty"></div>
        {% endfor %}
        {% for day in range(1, month.days + 1) %}
          {% set full_date = '{}-{:02d}-{:02d}'.format(year, month.month_number, day) %}
          {% if selected_habit %}
            <a class="dot {% if full_date in completed_dates %}active{% endif %}"
               href="{{ url_for('main.add_activity') }}?habit_id={{ selected_habit.id }}&date={{ full_date }}"
               title="Add activity for {{ full_date }}">
            </a>
          {% else %}
            <div class="dot"></div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
